<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Test getGeoPolygonArea()</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../../assets/require.css">
    </head>
    <body>
        <div id="qunit"></div>
        <div id="qunit-fixture"></div>        
        <script src="../../assets/qunit/qunit.js" type="text/javascript"></script>
        <script src="../../js/geoarea.js" type="text/javascript"></script>
        <script type="text/javascript">
            function getAreaShort( polygon ) {
                if (polygon.length < 3) {
                    throw new Error('polygon should have at least three points');
                }
                // first -> new last
                polygon.push( polygon[0] );
                var total = 0;
                var previous = polygon[0];
                var cx =0;
                var cy =0;

            for (var i = 1; i < polygon.length; i++) {
                cx = cx + polygon[i][1];
                cy = cy + polygon[i][0];
            }
                    cx = cx / polygon.length;
                    cy = cy / polygon.length;

                var xRef = cx+1;
                var yRef = cy+1;

                for (var i = 1; i < polygon.length; i++) {
                    var current = polygon[i];
                    var earthRadians = (6378137 * Math.PI / 180);
                    // convert to cartesian coordinates in meters, note this not very exact
                    var x1 = ((previous[1] - xRef) * earthRadians) * Math.cos(yRef * Math.PI / 180);
                    var y1 = ((previous[0] - yRef) * earthRadians);
                    var x2 = ((current[1] - xRef) * earthRadians) * Math.cos(yRef * Math.PI / 180);
                    var y2 = ((current[0] - yRef) * earthRadians);
                    total += (x1 * y2) - (x2 * y1);
                    previous = current;
                }
                return 0.5 * Math.abs(total);
            };
            
            // кадастровый участок из одного полигона 69:14:0000016:84 
            // кадастровая площадь 36.52 га
            var polygon = [
                [56.982548643784,36.836865268768],[56.982437653588,36.836797742369],[56.982067683878,36.83659516317],[56.98084675775,36.836325057572],[56.980254779157,36.836460110371],[56.979588791989,36.838485902357],[56.978441786167,36.83801321756],[56.977701763662,36.838350849558],[56.976406688891,36.836730215969],[56.975962652888,36.836325057572],[56.975740632901,36.83666268957],[56.975592618841,36.837135374366],[56.976221674533,36.838756007955],[56.978478786907,36.843145223925],[56.97892279291,36.848817441487],[56.979884787756,36.849897863879],[56.980106783038,36.849897863879],[56.980698763984,36.848749915087],[56.980957752689,36.848614862288],[56.981401729135,36.847601966295],[56.982215672203,36.846048859106],[56.98236365994,36.845508647909],[56.982992601261,36.837202900766]
            ];

            var area = FFGeo.getGeoPolygonArea( polygon );

            QUnit.test( "Total area of test polygon", function( assert ) {
                assert.ok( area === 363024.4218368292, area +" sq.meters vs " + getAreaShort( polygon ) );
            });
        </script>
    </body>
</html>
